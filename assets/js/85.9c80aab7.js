(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{409:function(s,a,e){"use strict";e.r(a);var n=e(4),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"使用docker搭建es"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用docker搭建es"}},[s._v("#")]),s._v(" 使用docker搭建ES")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2.2"')]),s._v("\nservices:\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2\n    container_name: elk-es\n    restart: always\n    environment:\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启内存锁定")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bootstrap.memory_lock")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n      - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ES_JAVA_OPTS=-Xms512m -Xmx512m"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定单节点启动")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("discovery.type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("single-node\n    ulimits:\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消内存相关限制 用于开启内存锁定")]),s._v("\n      memlock:\n        soft: "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v("\n        hard: "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v("\n    volumes:\n      - ./data/es/data:/usr/share/elasticsearch/data\n      - ./data/es/logs:/usr/share/elasticsearch/logs\n      - ./data/es/plugins:/usr/share/elasticsearch/plugins\n      - ./data/es/config/analysis-hanlp:/usr/share/elasticsearch/config/analysis-hanlp\n      - ./data/es/config/jvm.options:/usr/share/elasticsearch/config/jvm.options\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("记得要给 data 目录权限")]),s._v(" "),a("p",[s._v("运行命令，启动 docker")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("安装 hanlp 分词器")]),s._v(" "),a("p",[s._v("推荐这个库 https://github.com/KennFalcon/elasticsearch-analysis-hanlp")]),s._v(" "),a("p",[s._v("在容器内运行")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./bin/elasticsearch-plugin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://github.com/KennFalcon/elasticsearch-analysis-hanlp/releases/download/v6.5.4/elasticsearch-analysis-hanlp-6.5.4.zip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此处的 hanlp 的版本要和 docker 中 es 的版本一致")]),s._v(" "),a("h1",{attrs:{id:"安装分词模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装分词模型"}},[s._v("#")]),s._v(" 安装分词模型")]),s._v(" "),a("p",[s._v("这个库的作者认为一些模型不是所有人都需要，所以默认是不带 crf 和 nlp 模型的，需要去 github.com/hankcs/HanLP/releases 下载对应版本的数据包，需要注意版本")]),s._v(" "),a("p",[s._v("安装之后需要重启 docker\n安装 crf 模型")]),s._v(" "),a("p",[s._v("先去下载对应的数据包，找到 data/model 中的 crf 文件夹，将此文件夹放入 data/es/plugins/analysis-hanlp/data/model 文件夹\n注意一些问题：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("1、本来的 plugin-security.policy 中的 FilePermission 会导致 es 报错，记得修改为 \n")])])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("// HanLP data directories\n//permission java.io.FilePermission "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugins/analysis-hanlp/data/-"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read,write,delete"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n//permission java.io.FilePermission "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugins/analysis-hanlp/hanlp.cache"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read,write,delete"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\npermission java.io.FilePermission "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<<ALL FILES>>"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read,write,delete"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("2、hanlp 分词模型安装之后重启 docker，如果不做处理会报错说找不到 hanlp.properties 文件，解决方案就是在 dockerfile 提前将几个关键文件挂载出来\n")])])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("   - ./data/es/config/analysis-hanlp:/usr/share/elasticsearch/config/analysis-hanlp\n   - ./data/es/config/jvm.options:/usr/share/elasticsearch/config/jvm.options\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);